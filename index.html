// Webhook URL
const DISCORD_WEBHOOK_URL = 'https://discord.com/api/webhooks/1470806458789789779/qYPxUhCU47XVPYXEreQB0iMovFFAXnKNlJuG0Hi3tQwTATtkV6QM51LQKKzwBYkyJuGS';

// ãƒ•ã‚©ãƒ¼ãƒ ã¨é€šçŸ¥ã®è¨­å®š
const CONFIG = {
    building: { 
        icon: 'ğŸ—ï¸', label: 'å»ºç¯‰å±Š', title: 'å»ºç¯‰å±Šã‚’å—ç†', color: 3447003, 
        warning: "âš ï¸ â€»æœ¬é€šçŸ¥ã¯ã€Œå±Šå‡ºã®å—ç†ã€ã‚’çŸ¥ã‚‰ã›ã‚‹ã‚‚ã®ã§ã‚ã‚Šã€ã€Œè¨±å¯ã€ã‚’æ„å‘³ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚è¨±å¯ãŒé™ã‚Šã‚‹å‰ã«ä½œæ¥­ã‚’é–‹å§‹ã—ãŸå ´åˆã€å·®ã—æˆ»ã—ã‚„æ’¤å»å¯¾è±¡ã¨ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚",
        fields: [{ label: 'ç”³è«‹è€…', name: 'ç”³è«‹è€…', required: true }, { label: 'å ´æ‰€ï¼ˆåº§æ¨™ãªã©ï¼‰', name: 'å ´æ‰€', required: true }, { label: 'è©³ç´°ï¼ˆä½¿ç”¨ç”¨é€”ãªã©ï¼‰', name: 'è©³ç´°', type: 'textarea' }] 
    },
    shop: { 
        icon: 'ğŸ’°', label: 'åº—èˆ—é–‹è¨­', title: 'åº—èˆ—é–‹è¨­å±Šã‚’å—ç†', color: 15844367, 
        warning: "âš ï¸ â€»æœ¬é€šçŸ¥ã¯ã€Œå±Šå‡ºã®å—ç†ã€ã‚’çŸ¥ã‚‰ã›ã‚‹ã‚‚ã®ã§ã‚ã‚Šã€ã€Œè¨±å¯ã€ã‚’æ„å‘³ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚è¨±å¯ãŒé™ã‚Šã‚‹å‰ã«ä½œæ¥­ã‚’é–‹å§‹ã—ãŸå ´åˆã€å·®ã—æˆ»ã—ã‚„æ’¤å»å¯¾è±¡ã¨ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚",
        fields: [{ label: 'ç”³è«‹è€…', name: 'ç”³è«‹è€…', required: true },{ label: 'åº—å', name: 'åº—å', required: true },  { label: 'å ´æ‰€ï¼ˆåº§æ¨™ãªã©ï¼‰', name: 'å ´æ‰€', required: true },{ label: 'å‚™è€ƒï¼ˆè²©å£²å½¢å¼ãªã©ï¼‰', name: 'å‚™è€ƒ' }] 
    },
    pioneer: { 
        icon: 'ğŸŒ²', label: 'é–‹æ‹“å±Š', title: 'é–‹æ‹“å±Šã‚’å—ç†', color: 3066993, 
        warning: "âš ï¸ â€»æœ¬é€šçŸ¥ã¯ã€Œå±Šå‡ºã®å—ç†ã€ã‚’çŸ¥ã‚‰ã›ã‚‹ã‚‚ã®ã§ã‚ã‚Šã€ã€Œè¨±å¯ã€ã‚’æ„å‘³ã™ã‚‹ã‚‚ã®ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚è¨±å¯ãŒé™ã‚Šã‚‹å‰ã«ä½œæ¥­ã‚’é–‹å§‹ã—ãŸå ´åˆã€å·®ã—æˆ»ã—ã‚„æ’¤å»å¯¾è±¡ã¨ãªã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚",
        fields: [{ label: 'ç”³è«‹è€…', name: 'ç”³è«‹è€…', required: true }, { label: 'ã‚¨ãƒªã‚¢', name: 'ã‚¨ãƒªã‚¢', required: true }, { label: 'ç›®çš„', name: 'ç›®çš„', type: 'textarea' }] 
    },
    disclosure: { 
        icon: 'ğŸ“‚', label: 'æƒ…å ±é–‹ç¤º', title: 'æƒ…å ±é–‹ç¤ºè«‹æ±‚ã‚’å—ç†', color: 3899382, 
        warning: "âš ï¸ ç¾åœ¨å¯©æŸ»ä¸­ã§ã™ã€‚é–‹ç¤ºã®å¯å¦ãŒæ±ºå®šã™ã‚‹ã¾ã§ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„ã€‚",
        fields: [{ label: 'ç”³è«‹è€…', name: 'ç”³è«‹è€…', required: true }, { label: 'è«‹æ±‚å†…å®¹', name: 'è«‹æ±‚å†…å®¹', required: true }, { label: 'ç†ç”±', name: 'ç†ç”±', type: 'textarea', required: true }] 
    }
};

function showMenu() { 
    document.getElementById('form-view').style.display = 'none'; 
    document.getElementById('menu-view').style.display = 'grid'; 
    document.getElementById('status-msg').style.display = 'none'; 
}

function openForm(type) {
    const data = CONFIG[type];
    const container = document.getElementById('form-container');
    document.getElementById('menu-view').style.display = 'none';
    document.getElementById('form-view').style.display = 'block';
    let html = `<div class="form-title">${data.icon} ${data.label}</div><form onsubmit="handleSubmit(event, '${type}')">`;
    data.fields.forEach(f => {
        html += `<div class="form-group"><label>${f.label}</label>`;
        if (f.type === 'textarea') html += `<textarea name="${f.name}" ${f.required ? 'required' : ''}></textarea>`;
        else html += `<input type="text" name="${f.name}" ${f.required ? 'required' : ''}>`;
        html += `</div>`;
    });
    html += `<button type="submit" class="submit-btn">ç”³è«‹ã‚’é€ä¿¡ã™ã‚‹</button></form>`;
    container.innerHTML = html;
}

async function handleSubmit(event, type) {
    event.preventDefault();
    const form = event.target;
    const config = CONFIG[type];
    const formData = new FormData(form);
    const btn = form.querySelector('.submit-btn');
    const statusBox = document.getElementById('status-msg');

    btn.disabled = true;
    btn.textContent = "é€ä¿¡ä¸­...";

    const fields = [];
    formData.forEach((value, key) => {
        fields.push({ name: `${key}`, value: value || "ãªã—", inline: false });
    });

    // --- ä¿®æ­£ç®‡æ‰€: payload ã®æ§‹é€ ã‚’æ­£ã—ãä¿®å¾© ---
    const payload = {
        embeds: [{
            title: `${config.icon} ${config.title}`,
            color: config.color,
            description: "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nä¸‹è¨˜ã®å†…å®¹ã§ç”³è«‹ã‚’å—ç†ã„ãŸã—ã¾ã—ãŸã€‚\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”",
            fields: [
                ...fields,
                { name: "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€", value: `**${config.warning}**`, inline: false }
            ],
            footer: { text: "ã‚µãƒ¼ãƒãƒ¼æ”¿åºœç”³è«‹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ " },
            timestamp: new Date().toISOString()
        }]
    };

    try {
        const res = await fetch(DISCORD_WEBHOOK_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });
        if (res.ok) {
            statusBox.textContent = "âœ… æ­£å¸¸ã«å—ç†ã•ã‚Œã¾ã—ãŸã€‚\né‹å–¶ã‹ã‚‰ã®é€šçŸ¥ã‚’ãŠå¾…ã¡ãã ã•ã„ã€‚";
            statusBox.className = "success";
            statusBox.style.display = "block";
            form.reset();
        } else { throw new Error(); }
    } catch (e) {
        statusBox.textContent = "âŒ é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
        statusBox.className = "error";
        statusBox.style.display = "block";
    } finally {
        btn.disabled = false;
        btn.textContent = "ç”³è«‹ã‚’é€ä¿¡ã™ã‚‹";
    }
}

